components:
  schemas:
    Cliente:
      title: 'Usuario del sistema'
      description: >
        Cualquier usuario del sistema 
      type: object
      properties:
        cliente:
          type: object
          required: [ id, dni ]
          properties:
            id:
              $ref: '#/components/schemas/Id_Cliente'
            dni:
              $ref: '#/components/schemas/DNI_Cliente'
            nombre:
              $ref: '#/components/schemas/Nombre_Cliente'
            apellidos:
              $ref: '#/components/schemas/Apellidos_Cliente'
            direccion:
              $ref: '#/components/schemas/Direccion_Cliente'
            cuenta_bancaria:
              $ref: '#/components/schemas/CuentaBancaria_Cliente'
            links:
              description: Enlaces de relación del Cliente
              readOnly: true
              type: object
              properties:
                parent:
                  $ref: '#/components/schemas/Link'
                self:
                  $ref: '#/components/schemas/Link'
      example: { "cliente": {
                     "id": "P02-001-A",
                     "dni": "12345678u",
                     "nombre": "Pablito",
                     "apellidos" : "Clava Clavitos",
                     "direccion" : "miCasa",
                     "cuenta_bancaria" : "1111 1111 1111 1111",
                     "links": {
                       "parent": {
                         "href": "https://example.com/api/v1/clientes",
                         "rel": "cliente_post cliente_cget"
                       },
                       "self": {
                          "href": "https://example.com/api/v1/cliente/P01-123-Z",
                          "rel": "cliente_get cliente_delete cliente_put"
                       }
                     }
                  }
                }

    Id_Cliente:
      title: Identificador único del cliente
      type: string
      pattern: "^[A-Z]{1}[0-9]{2}-[0-9]{3}-[A-Z]$"
      example: "P01-001-A"
      #x-faker: helpers.regexpStyleStringParse('P[10-99]-[100-999]-X')

    DNI_Cliente:
      title: DNI del cliente
      type: string
      pattern: "[0-9]{8}[AZ]{1}"
      example: "12345678u"
      #x-faker: helpers.regexpStyleStringParse('P[10-99]-[100-999]-X')
      
    Nombre_Cliente:
      title: Nombre del cliente
      type: string
      example: "Victor"

    Apellidos_Cliente:
      title: Apellidos del cliente
      type: string
      example: "Mitrana"

    Direccion_Cliente:
      title: Dirección del cliente
      type: string
      example: "calle de mi casa 1 1º A"

    CuentaBancaria_Cliente:
      title: Cuenta bancaria del cliente
      type: string
      pattern: "[a-zA-Z]{2}[0-9]{20}"
      example: "aa010101010101010101010"

    HTTP_Problem:
      type: object
      externalDocs:
        url: https://tools.ietf.org/html/rfc7807
      description: |
        Problem Details for HTTP APIs
        [https://tools.ietf.org/html/rfc7807](https://tools.ietf.org/html/rfc7807)
      properties:
        type:
          type: string
          format: uri
          description: A URI reference [RFC3986] that identifies the problem type
        title:
          type: string
          description: short human-readable summary of the problem type
        status:
          type: number
          description: HTTP status code
        detail:
          type: string
          description: Human-readable explanation specific to this occurrence of the problem
        instance:
          type: string
          format: uri
          description: >
            A URI reference that identifies the specific occurrence of the problem.
            It may or may not yield further information if dereferenced.

    Link:
      description: Enlace de relación
      title: '🔗 Link'
      type: object
      properties:
        href:
          description: URL del enlace
          type: string
          format: uri
          x-faker: internet.url
        rel:
          description: "Relación del recurso enlazado con el actual. Contiene una lista de tipos
                    de relaciones separados por espacio."
          type: string
          x-faker: lorem.words
      example:
        href: https://www.example.com/path/resource
        rel: relAction1 relAction2

  headers:
    ETag:
      description: "Entity Tag (identificador único proporcionado para validación de caché)"
      schema:
        type: string
        pattern: "[0-9a-f]*"
        example:
          33a64df551425fcc
    Allow:
      description: Lista de métodos HTTP soportados
      schema:
        type: string
      example: GET, DELETE, PUT, OPTIONS
    Location:
      description: '`URI` del nuevo recurso'
      schema:
        type: string
        format: uri
        x-faker: internet.url
        example:
          https://example.com/api/v1/plataformas/P01-001-A

  requestBodies:
    clienteRB:
      description: Información de la nueva Plataforma
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [ id, dni ]
            properties:
              id:
                $ref: '#/components/schemas/Id_Cliente'
              dni:
                $ref: '#/components/schemas/DNI_Cliente'
              nombre:
                $ref: '#/components/schemas/Nombre_Cliente'
              apellidos:
                $ref: '#/components/schemas/Apellidos_Cliente'
              direccion:
                $ref: '#/components/schemas/Direccion_Cliente'
              cuenta_bancaria:
                $ref: '#/components/schemas/CuentaBancaria_Cliente'


  responses:
    Response_400:
      description: '`BAD REQUEST` El identificador único ya existe.'
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-400:
              $ref: '#/components/examples/response-http-400'
    Response_404:
      description: '`NOT FOUND`: recurso no disponible'
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-404:
              $ref: '#/components/examples/response-http-404'
    Response_409:
      description: '`CONFLICT`: el recurso no reúne las condiciones adecuadas'
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-404:
              $ref: '#/components/examples/response-http-409'
    Response_412:
      description: '`PRECONDITION FAILED`: El ETag proporcionado no está actualizado'
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-412:
              $ref: '#/components/examples/response-http-412'
    Response_422:
      description: '`UNPROCESSABLE ENTITY` Falta alguno de los atributos obligatorios o son incorrectos.'
      content:
        application/problem+json:
          schema:
            $ref: '#/components/schemas/HTTP_Problem'
          examples:
            response-http-422:
              $ref: '#/components/examples/response-http-422'

  parameters:
    clienteId:
      name: cliente_id
      in: path
      description: Identificador único del Cliente
      required: true
      schema:
        $ref: '#/components/schemas/Id_Cliente'
    ifMatchParam:
      name: If-Match
      in: header
      description: ETag actual del recurso que se desea modificar
      required: true
      schema:
        type: string
        pattern: "[0-9a-f]*"
    orderParam:
      name: order
      in: query
      description: 'Criterio de ordenación: `id`'
      required: false
      allowEmptyValue: false
      schema:
        type: string
        enum:
          - id
    orderingParam:
      name: ordering
      in: query
      description: 'Ordenación: `ASC` | `DESC`'
      required: false
      allowEmptyValue: false
      schema:
        type: string
        enum:
          - ASC
          - DESC
    pageParam:
      name: page
      in: query
      description: 'Número de página'
      required: false
      allowEmptyValue: false
      schema:
        type: integer
        minimum: 1

  examples:
    clientes-example:
      value:
        clientes:
          - { "cliente": { "id": "P01-001-A", "dni": "12345678u", "nombre" : "Pepe", "apellidos" : "Popo Pipi", "direccion" : "mi casa 1", "cuenta_bancaria" : "aa10101010101010101010",
                "links": {
                  "parent": { "href": "https://example.com/api/v1/clientes", "rel": "cliente_post cliente_cget"},
                  "self": { "href": "https://example.com/api/v1/clientes/P01-001-A", "rel": "cliente_get cliente_delete cliente_put" }
              }}}
          - { "cliente": { "id": "P02-039-C", "dni": "98765432w", "nombre" : "Manuel", "apellidos" : "Ottaviano", "direccion" : "upm 2", "cuenta_bancaria" : "aa22101010101010101010",
                "links": {
                  "parent": { "href": "https://example.com/api/v1/clientes", "rel": "cliente_post cliente_cget"},
                  "self": { "href": "https://example.com/api/v1/clientes/P02-039-C", "rel": "cliente_get cliente_delete cliente_put" }
              }}}
        links: {
          "prevPage": { "href": "https://example.com/api/v1/clientes?page=2", "rel": "prevPage" },
          "nextPage": { "href": "https://example.com/api/v1/clientes?page=4", "rel": "nextPage" }
        }

    response-http-400:
      value:
        type: https://httpstatuses.com/400
        title: UNPROCESSABLE ENTITY
        status: 400
        detail: El identificador único ya existe
        instance: about:blank
    response-http-404:
      value:
        type: https://httpstatuses.com/404
        title: NOT FOUND
        status: 404
        detail: El recurso solicitado no está disponible.
        instance: about:blank
    response-http-409:
      value:
        type: https://httpstatuses.com/409
        title: NOT FOUND
        status: 409
        detail: El recurso no reúne las condiciones requeridas para la operación.
        instance: about:blank
    response-http-412:
      value:
        type: https://httpstatuses.com/412
        title: PRECONDITION FAILED
        status: 412
        detail: El ETag proporcionado no está actualizado
        instance: about:blank
    response-http-422:
      value:
        type: https://httpstatuses.com/422
        title: UNPROCESSABLE ENTITY
        status: 422
        detail: Falta alguno de los atributos obligatorios o contiene un valor no admitido
        instance: about:blank